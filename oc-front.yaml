---
- hosts: localhost
  connection: local
  become: yes
  become_user: root

  pre_tasks:
    - name: "Install packages"
      apt: 
        name:
          - apache2
          - git
          - php
          - php-mysql
          - libapache2-mod-php
          - php-cli
          - php-common
          - php-intl
          - php-gd
          - php-mbstring
          - php-xml
          - php-zip
          - php-curl
          - php-xmlrpc
          - unzip
          - open-vm-tools

  tasks:
    - name: "Pull OpenCart demo from Github"
      git:
        repo: "https://github.com/jsenicka/opencart-demo.git"
        dest: "/tmp/opencart"
    - name: "Copy OpenCart files to /var/www/html"
      command: {{ item }}
      with_items:
        - mv /tmp/opencart /var/www/opencart
        - chown -R www-data.www-data /var/www/opencart
        - chmod -R 755 /var/www/opencart
    - name: "Start and enable services"
      service: "name={{ item }} state=started enabled=yes"
      with_items:
        - apache2